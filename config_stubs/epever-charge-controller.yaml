# Datasheet: B-Series MODBUS Specification EPEVER Corporation V 2.3 June 12, 2015
# available at: https://www.developpez.net/forums/attachments/p196506d1451307310/systemes/autres-systemes/automation/probleme-com-modbus-pl7-pro/controllerprotocolv2.3.pdf/

devices:
  - id: epever-xtra-4415n
    name: EPEVER XTRA 4415N MPPT solar charge controller
    serial:
      port: /dev/ttyUSB0
      baud_rate: 115200
      data_bits: 8
      stop_bits: 1
      parity: N
      timeout: 0.05
    protocol:
      modbus_address: 0x11
  - id: epever-xtra-4415n-relaxed-timeout
    name: EPEVER XTRA 4415N MPPT solar charge controller
    serial:
      port: /dev/ttyUSB0
      baud_rate: 115200
      data_bits: 8
      stop_bits: 1
      parity: N
      timeout: 0.15
    protocol:
      modbus_address: 0x11

tasks:
  - id: e-datetime
    name: current date and time
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/datetime
    value:
      type: datetime
      data:
        - byte:
            register_type: holding
            address: 0x9015
            byte_index: 0
            increase_by: 2000
        - byte:
            register_type: holding
            address: 0x9015
            byte_index: 1
        - byte:
            register_type: holding
            address: 0x9014
            byte_index: 0
        - byte:
            register_type: holding
            address: 0x9014
            byte_index: 1
        - byte:
            register_type: holding
            address: 0x9013
            byte_index: 0
        - byte:
            register_type: holding
            address: 0x9013
            byte_index: 1
  - id: e-device-over-temperature
    name: device temperature higher than over-temperature protection point
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/device-over-temperature
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            register_type: discrete
            address: 0x2000
  - id: e-night-time
    name: night time detected
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/night-time
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            register_type: discrete
            address: 0x200C
  - id: e-solar-rated-voltage
    name: solar rated voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/solar-rated-voltage
    value:
      data:
        - short:
            address: 0x3000
            scale_factor: 100
  - id: e-solar-rated-current
    name: solar rated current in A
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/solar-rated-current
    value:
      data:
        - short:
            address: 0x3001
            scale_factor: 100
  - id: e-solar-rated-power
    name: solar rated power in W
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/solar-rated-power
    value:
      data:
        - long:
            register_count: 2
            address: 0x3002
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-battery-rated-voltage
    name: battery rated voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-rated-voltage
    value:
      data:
        - short:
            address: 0x3004
            scale_factor: 100
  - id: e-battery-rated-current
    name: battery rated current in A
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-rated-current
    value:
      data:
        - short:
            address: 0x3005
            scale_factor: 100
  - id: e-battery-rated-power
    name: battery rated power in W
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-rated-power
    value:
      data:
        - long:
            register_count: 2
            address: 0x3006
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-charging-mode
    name: charging mode
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/charging-mode
    value:
      mapping:
        0: connect / disconnect
        1: PWM
        2: MPTT
      data:
        - short:
            address: 0x3008
  - id: e-load-rated-current
    name: load rated current in A
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-rated-current
    value:
      data:
        - short:
            address: 0x300E
            scale_factor: 100
  - id: e-solar-voltage
    name: solar voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/solar-voltage
    value:
      data:
        - short:
            address: 0x3100
            scale_factor: 100
  - id: e-solar-current
    name: solar current in A
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/solar-current
    value:
      data:
        - short:
            address: 0x3101
            scale_factor: 100
  - id: e-solar-power
    name: solar power in W
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/solar-power
    value:
      data:
        - long:
            register_count: 2
            address: 0x3102
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-battery-charging-power
    name: battery charging power in W
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-charging-power
    value:
      data:
        - long:
            register_count: 2
            address: 0x3106
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-load-voltage
    name: load voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-voltage
    value:
      data:
        - short:
            address: 0x310C
            scale_factor: 100
  - id: e-load-current
    name: load current in A
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-current
    value:
      data:
        - short:
            address: 0x310D
            scale_factor: 100
  - id: e-load-power
    name: load power in W
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-power
    value:
      data:
        - long:
            register_count: 2
            address: 0x310E
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-battery-temperature
    name: battery temperature in degrees Celsius
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-temperature
    value:
      data:
        - signed_short:
            address: 0x3110
            scale_factor: 100
  - id: e-device-temperature
    name: device temperature in degrees Celsius
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/device-temperature
    value:
      data:
        - signed_short:
            address: 0x3111
            scale_factor: 100
  - id: e-power-components-temperature
    name: power components' temperature in degrees Celsius
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/power-components-temperature
    value:
      data:
        - signed_short:
            address: 0x3112
            scale_factor: 100
  - id: e-battery-estimated-soc
    name: "battery estimated state of charge in %"
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-estimated-soc
    value:
      data:
        - short:
            address: 0x311A
  - id: e-remote-battery-temperature
    name: battery temperature reported by remote sensor in degrees Celsius
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/remote-battery-temperature
    value:
      data:
        - signed_short:
            address: 0x311B
            scale_factor: 100
  - id: e-system-voltage
    name: system voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/system-voltage
    value:
      data:
        - short:
            address: 0x311D
            scale_factor: 100
  - id: e-battery-voltage-status
    name: battery voltage status
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-voltage-status
    value:
      mapping:
        0: normal
        1: overvoltage
        2: undervoltage
        3: low voltage disconnect
        4: fault
      data:
        - short:
            address: 0x3200
            bitmask: 0b1111
  - id: e-battery-temperature-status
    name: battery temperature status
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-temperature-status
    value:
      mapping:
        0: normal
        1: high temperature warning
        2: low temperature warning
      data:
        - short:
            address: 0x3200
            bitmask: 0b11110000
            bitshift: 4
  - id: e-battery-internal-resistance-abnormal
    name: battery internal resistance abnormal
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-internal-resistance-abnormal
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3200
            byte_index: 0
            bitmask: 0b1
  - id: e-battery-voltage-identification-incorrect
    name: battery voltage identification incorrect
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-voltage-identification-incorrect
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3200
            byte_index: 0
            bitmask: 0b10000000
            bitshift: 7
  - id: e-input-voltage-status
    name: input voltage status
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/input-voltage-status
    value:
      mapping:
        0: normal
        1: no power connected
        2: input voltage higher
        3: input voltage error
      data:
        - byte:
            address: 0x3201
            byte_index: 0
            bitmask: 0b11000000
            bitshift: 6
  - id: e-charging-mosfet-shorted
    name: charging MOSFET shorted
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/charging-mosfet-shorted
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 0
            bitmask: 0b00100000
            bitshift: 5
  - id: e-charging-or-anti-reverse-mosfet-shorted
    name: charging or anti-reverse MOSFET shorted
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/charging-or-anti-reverse-mosfet-shorted
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 0
            bitmask: 0b00010000
            bitshift: 4
  - id: e-anti-reverse-mosfet-shorted
    name: anti-reverse MOSFET shorted
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/anti-reverse-mosfet-shorted
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 0
            bitmask: 0b00001000
            bitshift: 3
  - id: e-input-overcurrent
    name: input overcurrent
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/input-overcurrent
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 0
            bitmask: 0b00000100
            bitshift: 2
  - id: e-load-overcurrent
    name: load overcurrent
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-overcurrent
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 0
            bitmask: 0b00000010
            bitshift: 1
  - id: e-load-shorted
    name: load shorted
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-shorted
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 0
            bitmask: 0b00000001
  - id: e-load-mosfet-shorted
    name: load MOSFET shorted
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-mosfet-shorted
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 1
            bitmask: 0b10000000
            bitshift: 7
  - id: e-charging-type
    name: charging charging type
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/charging-type
    value:
      mapping:
        0: no charging
        1: float
        2: boost
        3: equalization
      data:
        - byte:
            address: 0x3201
            byte_index: 1
            bitmask: 0b1100
            bitshift: 2
  - id: e-charging-equipment-fault
    name: charging equipment fault
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/charging-equipment-fault
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 1
            bitmask: 0b10
            bitshift: 1
  - id: e-charging-equipment-running
    name: charging equipment running
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/charging-equipment-running
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3201
            byte_index: 1
            bitmask: 0b1
  - id: e-load-voltage-status
    name: load voltage status
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-voltage-status
    value:
      mapping:
        0: normal
        1: low
        2: high
        3: no access
      data:
        - byte:
            address: 0x3202
            byte_index: 0
            bitmask: 0b11000000
            bitshift: 6
  - id: e-load-power-status
    name: load power status
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/load-power-status
    value:
      mapping:
        0: light load
        1: moderate load
        2: rated load
        3: overload
      data:
        - byte:
            address: 0x3202
            byte_index: 0
            bitmask: 0b110000
            bitshift: 4
  - id: e-discharging-equipment-shorted
    name: discharging equipment shorted
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-shorted
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 0
            bitmask: 0b1000
            bitshift: 3
  - id: e-discharging-equipment-unable-to-discharge
    name: discharging equipment unable to discharge
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-unable-to-discharge
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 0
            bitmask: 0b100
            bitshift: 2
  - id: e-discharging-equipment-unable-to-stop-discharging
    name: discharging equipment unable to stop discharging
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-unable-to-stop-discharging
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 0
            bitmask: 0b10
            bitshift: 1
  - id: e-discharging-equipment-output-voltage-abnormal
    name: discharging equipment output voltage abnormal
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-output-voltage-abnormal
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 0
            bitmask: 0b1
  - id: e-discharging-equipment-input-overvoltage
    name: discharging equipment input overvoltage
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-input-overvoltage
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 1
            bitmask: 0b10000000
            bitshift: 7
  - id: e-discharging-equipment-high-voltage-side-shorted
    name: discharging equipment high voltage side shorted
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-high-voltage-side-shorted
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 1
            bitmask: 0b1000000
            bitshift: 6
  - id: e-discharging-equipment-boost-overvoltage
    name: discharging equipment boost overvoltage
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-boost-overvoltage
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 1
            bitmask: 0b100000
            bitshift: 5
  - id: e-discharging-equipment-output-overvoltage
    name: discharging equipment output overvoltage
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-output-overvoltage
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 1
            bitmask: 0b10000
            bitshift: 4
  - id: e-discharging-equipment-fault
    name: discharging equipment fault
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-fault
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 1
            bitmask: 0b10
            bitshift: 1
  - id: e-discharging-equipment-running
    name: discharging equipment running
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/discharging-equipment-running
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            address: 0x3202
            byte_index: 1
            bitmask: 0b1
  - id: e-maximum-solar-voltage-today
    name: maximum solar voltage today in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/maximum-solar-voltage-today
    value:
      data:
        - short:
            address: 0x3300
            scale_factor: 100
  - id: e-minimum-solar-voltage-today
    name: minimum solar voltage today in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/minimum-solar-voltage-today
    value:
      data:
        - short:
            address: 0x3301
            scale_factor: 100
  - id: e-maximum-battery-voltage-today
    name: maximum battery voltage today in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/maximum-battery-voltage-today
    value:
      data:
        - short:
            address: 0x3302
            scale_factor: 100
  - id: e-minimum-battery-voltage-today
    name: minimum battery voltage today in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/minimum-battery-voltage-today
    value:
      data:
        - short:
            address: 0x3303
            scale_factor: 100
  - id: e-consumed-energy-today
    name: consumed energy today in kWh
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/consumed-energy-today
    value:
      data:
        - long:
            register_count: 2
            address: 0x3304
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-consumed-energy-this-month
    name: consumed energy this month in kWh
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/consumed-energy-this-month
    value:
      data:
        - long:
            register_count: 2
            address: 0x3306
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-consumed-energy-this-year
    name: consumed energy this year in kWh
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/consumed-energy-this-year
    value:
      data:
        - long:
            register_count: 2
            address: 0x3308
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-consumed-energy
    name: consumed energy in kWh
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/consumed-energy
    value:
      data:
        - long:
            register_count: 2
            address: 0x330A
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-generated-energy-today
    name: generated energy today in kWh
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/generated-energy-today
    value:
      data:
        - long:
            register_count: 2
            address: 0x330C
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-generated-energy-this-month
    name: generated energy this month in kWh
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/generated-energy-this-month
    value:
      data:
        - long:
            register_count: 2
            address: 0x330E
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-generated-energy-this-year
    name: generated energy this year in kWh
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/generated-energy-this-year
    value:
      data:
        - long:
            register_count: 2
            address: 0x3310
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-generated-energy
    name: generated energy in kWh
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/generated-energy
    value:
      data:
        - long:
            register_count: 2
            address: 0x3312
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-battery-voltage
    name: battery voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-voltage
    value:
      data:
        - short:
            address: 0x331A
            scale_factor: 100
  - id: e-battery-net-current
    name: battery net current in A
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-net-current
    value:
      data:
        - signed_long:
            register_count: 2
            address: 0x331B
            byte_order:
              - 2
              - 3
              - 0
              - 1
            scale_factor: 100
  - id: e-combined-battery-temperature
    name: combined battery temperature in degrees Celsius
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/combined-battery-temperature
    value:
      data:
        - signed_short:
            address: 0x331D
            scale_factor: 100
  - id: e-ambient-temperature
    name: ambient temperature in degrees Celsius
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/ambient-temperature
    value:
      data:
        - signed_short:
            address: 0x331E
            scale_factor: 100
  - id: e-battery-type
    name: battery type
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-type
    value:
      mapping:
        0: user-defined
        1: sealed
        2: gel
        3: flooded
        4: 4S LiFePo4
      data:
        - short:
            register_type: holding
            address: 0x9000
  - id: e-battery-rated-electric-charge
    name: battery rated electric charge in Ah
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-rated-electric-charge
    value:
      data:
        - short:
            register_type: holding
            address: 0x9001
  - id: e-temperature-compensation-coefficient
    name: battery temperature ation coefficient in mv/K/2V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/temperature-compensation-coefficient
    value:
      data:
        - signed_short:
            register_type: holding
            address: 0x9002
            scale_factor: 100
  - id: e-battery-high-voltage-disconnect
    name: battery high voltage disconnect voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-high-voltage-disconnect
    value:
      data:
        - short:
            register_type: holding
            address: 0x9003
            scale_factor: 100
  - id: e-battery-charging-limit-voltage
    name: battery charging limit voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-charging-limit-voltage
    value:
      data:
        - short:
            register_type: holding
            address: 0x9004
            scale_factor: 100
  - id: e-battery-high-voltage-reconnect
    name: battery high voltage reconnect voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-high-voltage-reconnect
    value:
      data:
        - short:
            register_type: holding
            address: 0x9005
            scale_factor: 100
  - id: e-battery-equalization-voltage
    name: battery equalization voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-equalization-voltage
    value:
      data:
        - short:
            register_type: holding
            address: 0x9006
            scale_factor: 100
  - id: e-battery-boost-voltage
    name: battery boost voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-boost-voltage
    value:
      data:
        - short:
            register_type: holding
            address: 0x9007
            scale_factor: 100
  - id: e-battery-float-voltage
    name: battery float voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-float-voltage
    value:
      data:
        - short:
            register_type: holding
            address: 0x9008
            scale_factor: 100
  - id: e-battery-boost-reconnect-voltage
    name: battery boost reconnect voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-boost-reconnect-voltage
    value:
      data:
        - short:
            register_type: holding
            address: 0x9009
            scale_factor: 100
  - id: e-battery-low-voltage-reconnect
    name: battery low voltage reconnect voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-low-voltage-reconnect
    value:
      data:
        - short:
            register_type: holding
            address: 0x900A
            scale_factor: 100
  - id: e-battery-undervoltage-recovery
    name: battery undervoltage recovery voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-undervoltage-recovery
    value:
      data:
        - short:
            register_type: holding
            address: 0x900B
            scale_factor: 100
  - id: e-battery-undervoltage-warning
    name: battery undervoltage warning voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-undervoltage-warning
    value:
      data:
        - short:
            register_type: holding
            address: 0x900C
            scale_factor: 100
  - id: e-battery-low-voltage-disconnect
    name: battery low voltage disconnect voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-low-voltage-disconnect
    value:
      data:
        - short:
            register_type: holding
            address: 0x900D
            scale_factor: 100
  - id: e-battery-discharging-limit
    name: battery discharging limit voltage in V
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-discharging-limit
    value:
      data:
        - short:
            register_type: holding
            address: 0x900E
            scale_factor: 100
  - id: e-battery-equalization-cycle
    name: battery equalization cycle length in days
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-equalization-cycle
    value:
      data:
        - short:
            register_type: holding
            address: 0x9016
  - id: e-battery-equalization-duration
    name: battery equalization duration in minutes
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-equalization-duration
    value:
      data:
        - short:
            register_type: holding
            address: 0x906B
  - id: e-battery-boost-duration
    name: battery boost duration in minutes
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-boost-duration
    value:
      data:
        - short:
            register_type: holding
            address: 0x906C
  - id: e-battery-impedance
    name: impedance of the battery connection in milliOhms
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/battery-impedance
    value:
      data:
        - short:
            register_type: holding
            address: 0x901D
            scale_factor: 100
  - id: e-charging-device-on
    name: charging device turned on
    device: epever-xtra-4415n
    mqtt_topic: epever-xtra-4415n/charging-device-on
    value:
      mapping:
        0: OFF
        1: ON
      data:
        - byte:
            register_type: coil
            address: 0x0

jobs:
  - id: charge-controller-diagnostics
    mqtt_messages:
      - homeassistant/binary_sensor/default/charge-controller-device-over-temperature/config:
          device:
            name: EPEVER solar charge controller
            manufacturer: EPEVER
            model: XTRA 4415N
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Device over-temperature
          state_topic: epever-xtra-4415n/device-over-temperature
          object_id: epever-xtra-4415n-over-temperature
          unique_id: epever-xtra-4415n-over-temperature
      - homeassistant/binary_sensor/default/charge-controller-night-time/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Night time
          state_topic: epever-xtra-4415n/night-time
          object_id: epever-xtra-4415n-night-time
          unique_id: epever-xtra-4415n-night-time
      - homeassistant/sensor/default/charge-controller-solar-rated-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: voltage
          name: Solar rated voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/solar-rated-voltage
          object_id: epever-xtra-4415n-solar-rated-voltage
          unique_id: epever-xtra-4415n-solar-rated-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-solar-rated-current/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: current
          name: Solar rated current
          state_class: measurement
          state_topic: epever-xtra-4415n/solar-rated-current
          object_id: epever-xtra-4415n-solar-rated-current
          unique_id: epever-xtra-4415n-solar-rated-current
          unit_of_measurement: A
      - homeassistant/sensor/default/charge-controller-solar-rated-power/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: power
          name: Solar rated power
          state_class: measurement
          state_topic: epever-xtra-4415n/solar-rated-power
          object_id: epever-xtra-4415n-solar-rated-power
          unique_id: epever-xtra-4415n-solar-rated-power
          unit_of_measurement: W
      - homeassistant/sensor/default/charge-controller-battery-rated-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: voltage
          name: Battery rated voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-rated-voltage
          object_id: epever-xtra-4415n-battery-rated-voltage
          unique_id: epever-xtra-4415n-battery-rated-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-rated-current/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: current
          name: Battery rated current
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-rated-current
          object_id: epever-xtra-4415n-battery-rated-current
          unique_id: epever-xtra-4415n-battery-rated-current
          unit_of_measurement: A
      - homeassistant/sensor/default/charge-controller-battery-rated-power/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: power
          name: Battery rated power
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-rated-power
          object_id: epever-xtra-4415n-battery-rated-power
          unique_id: epever-xtra-4415n-battery-rated-power
          unit_of_measurement: W
      - homeassistant/sensor/default/charge-controller-charging-mode/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Charging mode
          state_topic: epever-xtra-4415n/charging-mode
          object_id: epever-xtra-4415n-charging-mode
          unique_id: epever-xtra-4415n-charging-mode
      - homeassistant/sensor/default/charge-controller-load-rated-current/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: current
          name: Load rated current
          state_class: measurement
          state_topic: epever-xtra-4415n/load-rated-current
          object_id: epever-xtra-4415n-load-rated-current
          unique_id: epever-xtra-4415n-load-rated-current
          unit_of_measurement: A
      - homeassistant/sensor/default/charge-controller-load-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: voltage
          name: Load voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/load-voltage
          object_id: epever-xtra-4415n-load-voltage
          unique_id: epever-xtra-4415n-load-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-load-current/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: current
          name: Load current
          state_class: measurement
          state_topic: epever-xtra-4415n/load-current
          object_id: epever-xtra-4415n-load-current
          unique_id: epever-xtra-4415n-load-current
          unit_of_measurement: A
      - homeassistant/sensor/default/charge-controller-load-power/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: power
          name: Load power
          state_class: measurement
          state_topic: epever-xtra-4415n/load-power
          object_id: epever-xtra-4415n-load-power
          unique_id: epever-xtra-4415n-load-power
          unit_of_measurement: W
      - homeassistant/sensor/default/charge-controller-system-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: voltage
          name: System voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/system-voltage
          object_id: epever-xtra-4415n-system-voltage
          unique_id: epever-xtra-4415n-system-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-maximum-solar-voltage-today/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: voltage
          name: Maximum solar voltage today
          state_class: measurement
          state_topic: epever-xtra-4415n/maximum-solar-voltage-today
          object_id: epever-xtra-4415n-maximum-solar-voltage-today
          unique_id: epever-xtra-4415n-maximum-solar-voltage-today
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-minimum-solar-voltage-today/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: voltage
          name: Minimum solar voltage today
          state_class: measurement
          state_topic: epever-xtra-4415n/minimum-solar-voltage-today
          object_id: epever-xtra-4415n-minimum-solar-voltage-today
          unique_id: epever-xtra-4415n-minimum-solar-voltage-today
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-maximum-battery-voltage-today/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: voltage
          name: Maximum battery voltage today
          state_class: measurement
          state_topic: epever-xtra-4415n/maximum-battery-voltage-today
          object_id: epever-xtra-4415n-maximum-battery-voltage-today
          unique_id: epever-xtra-4415n-maximum-battery-voltage-today
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-minimum-battery-voltage-today/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          device_class: voltage
          name: Minimum battery voltage today
          state_class: measurement
          state_topic: epever-xtra-4415n/minimum-battery-voltage-today
          object_id: epever-xtra-4415n-minimum-battery-voltage-today
          unique_id: epever-xtra-4415n-minimum-battery-voltage-today
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-consumed-energy-today/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: energy
          name: Consumed energy today
          state_class: total_increasing
          state_topic: epever-xtra-4415n/consumed-energy-today
          object_id: epever-xtra-4415n-consumed-energy-today
          unique_id: epever-xtra-4415n-consumed-energy-today
          unit_of_measurement: kWh
      - homeassistant/sensor/default/charge-controller-consumed-energy-this-month/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: energy
          name: Consumed energy this month
          state_class: total_increasing
          state_topic: epever-xtra-4415n/consumed-energy-this-month
          object_id: epever-xtra-4415n-consumed-energy-this-month
          unique_id: epever-xtra-4415n-consumed-energy-this-month
          unit_of_measurement: kWh
      - homeassistant/sensor/default/charge-controller-consumed-energy-this-year/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: energy
          name: Consumed energy this year
          state_class: total_increasing
          state_topic: epever-xtra-4415n/consumed-energy-this-year
          object_id: epever-xtra-4415n-consumed-energy-this-year
          unique_id: epever-xtra-4415n-consumed-energy-this-year
          unit_of_measurement: kWh
      - homeassistant/sensor/default/charge-controller-consumed-energy/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: energy
          name: Consumed energy
          state_class: total_increasing
          state_topic: epever-xtra-4415n/consumed-energy
          object_id: epever-xtra-4415n-consumed-energy
          unique_id: epever-xtra-4415n-consumed-energy
          unit_of_measurement: kWh
      - homeassistant/sensor/default/charge-controller-generated-energy-today/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: energy
          name: Generated energy today
          state_class: total_increasing
          state_topic: epever-xtra-4415n/generated-energy-today
          object_id: epever-xtra-4415n-generated-energy-today
          unique_id: epever-xtra-4415n-generated-energy-today
          unit_of_measurement: kWh
      - homeassistant/sensor/default/charge-controller-generated-energy-this-month/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: energy
          name: Generated energy this month
          state_class: total_increasing
          state_topic: epever-xtra-4415n/generated-energy-this-month
          object_id: epever-xtra-4415n-generated-energy-this-month
          unique_id: epever-xtra-4415n-generated-energy-this-month
          unit_of_measurement: kWh
      - homeassistant/sensor/default/charge-controller-generated-energy-this-year/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: energy
          name: Generated energy this year
          state_class: total_increasing
          state_topic: epever-xtra-4415n/generated-energy-this-year
          object_id: epever-xtra-4415n-generated-energy-this-year
          unique_id: epever-xtra-4415n-generated-energy-this-year
          unit_of_measurement: kWh
      - homeassistant/sensor/default/charge-controller-generated-energy/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: energy
          name: Generated energy
          state_class: total_increasing
          state_topic: epever-xtra-4415n/generated-energy
          object_id: epever-xtra-4415n-generated-energy
          unique_id: epever-xtra-4415n-generated-energy
          unit_of_measurement: kWh
      - homeassistant/sensor/default/charge-controller-datetime/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: timestamp
          entity_category: diagnostic
          name: Date and Time
          state_class: measurement
          state_topic: epever-xtra-4415n/datetime
          object_id: epever-xtra-4415n-datetime
          unique_id: epever-xtra-4415n-datetime
      - homeassistant/sensor/default/charge-controller-battery-type/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Battery Type
          state_topic: epever-xtra-4415n/battery-type
          object_id: epever-xtra-4415n-battery-type
          unique_id: epever-xtra-4415n-battery-type
      - homeassistant/sensor/default/charge-controller-battery-rated-electric-charge/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Battery Rated Electric Charge
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-rated-electric-charge
          object_id: epever-xtra-4415n-battery-rated-electric-charge
          unique_id: epever-xtra-4415n-battery-rated-electric-charge
          unit_of_measurement: Ah
      - homeassistant/sensor/default/charge-controller-temperature-compensation-coefficient/config:
          device:
            identifiers: epever-xtra-4415n
          name: Temperature Compensation Coefficient
          state_class: measurement
          state_topic: epever-xtra-4415n/temperature-compensation-coefficient
          object_id: epever-xtra-4415n-temperature-compensation-coefficient
          unique_id: epever-xtra-4415n-temperature-compensation-coefficient
          unit_of_measurement: mv/K/2V
      - homeassistant/sensor/default/charge-controller-battery-high-voltage-disconnect/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery High Voltage Disconnect
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-high-voltage-disconnect
          object_id: epever-xtra-4415n-battery-high-voltage-disconnect
          unique_id: epever-xtra-4415n-battery-high-voltage-disconnect
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-charging-limit-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Charging Limit Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-charging-limit-voltage
          object_id: epever-xtra-4415n-battery-charging-limit-voltage
          unique_id: epever-xtra-4415n-battery-charging-limit-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-high-voltage-reconnect/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery High Voltage Reconnect Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-high-voltage-reconnect
          object_id: epever-xtra-4415n-battery-high-voltage-reconnect
          unique_id: epever-xtra-4415n-battery-high-voltage-reconnect
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-equalization-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Equalization Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-equalization-voltage
          object_id: epever-xtra-4415n-battery-equalization-voltage
          unique_id: epever-xtra-4415n-battery-equalization-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-boost-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Boost Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-boost-voltage
          object_id: epever-xtra-4415n-battery-boost-voltage
          unique_id: epever-xtra-4415n-battery-boost-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-float-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Float Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-float-voltage
          object_id: epever-xtra-4415n-battery-float-voltage
          unique_id: epever-xtra-4415n-battery-float-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-boost-reconnect-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Boost Reconnect Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-boost-reconnect-voltage
          object_id: epever-xtra-4415n-battery-boost-reconnect-voltage
          unique_id: epever-xtra-4415n-battery-boost-reconnect-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-low-voltage-reconnect/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Low Voltage Reconnect Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-low-voltage-reconnect
          object_id: epever-xtra-4415n-battery-low-voltage-reconnect
          unique_id: epever-xtra-4415n-battery-low-voltage-reconnect
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-undervoltage-recovery/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Undervoltage Recovery Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-undervoltage-recovery
          object_id: epever-xtra-4415n-battery-undervoltage-recovery
          unique_id: epever-xtra-4415n-battery-undervoltage-recovery
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-undervoltage-warning/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Undervoltage Warning Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-undervoltage-warning
          object_id: epever-xtra-4415n-battery-undervoltage-warning
          unique_id: epever-xtra-4415n-battery-undervoltage-warning
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-low-voltage-disconnect/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Low Voltage Disconnect
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-low-voltage-disconnect
          object_id: epever-xtra-4415n-battery-low-voltage-disconnect
          unique_id: epever-xtra-4415n-battery-low-voltage-disconnect
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-discharging-limit/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Discharging Limit Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-discharging-limit
          object_id: epever-xtra-4415n-battery-discharging-limit
          unique_id: epever-xtra-4415n-battery-discharging-limit
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-equalization-cycle/config:
          device:
            identifiers: epever-xtra-4415n
          name: Battery Equalization Cycle
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-equalization-cycle
          object_id: epever-xtra-4415n-battery-equalization-cycle
          unique_id: epever-xtra-4415n-battery-equalization-cycle
          unit_of_measurement: days
      - homeassistant/sensor/default/charge-controller-battery-equalization-duration/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: duration
          name: Battery Equalization Duration
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-equalization-duration
          object_id: epever-xtra-4415n-battery-equalization-duration
          unique_id: epever-xtra-4415n-battery-equalization-duration
          unit_of_measurement: minutes
      - homeassistant/sensor/default/charge-controller-battery-boost-duration/config:
          device:
            identifiers: epever-xtra-4415n
          name: Battery Boost Duration
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-boost-duration
          object_id: epever-xtra-4415n-battery-boost-duration
          unique_id: epever-xtra-4415n-battery-boost-duration
          unit_of_measurement: minutes
    sleep: 1000
    tasks:
      - e-device-over-temperature
      - e-night-time
      - e-solar-rated-voltage
      - e-solar-rated-current
      - e-solar-rated-power
      - e-battery-rated-voltage
      - e-battery-rated-current
      - e-battery-rated-power
      - e-charging-mode
      - e-load-rated-current
      - e-load-voltage
      - e-load-current
      - e-load-power
      - e-system-voltage
      - e-maximum-solar-voltage-today
      - e-minimum-solar-voltage-today
      - e-maximum-battery-voltage-today
      - e-minimum-battery-voltage-today
      - e-consumed-energy-today
      - e-consumed-energy-this-month
      - e-consumed-energy-this-year
      - e-consumed-energy
      - e-generated-energy-today
      - e-generated-energy-this-month
      - e-generated-energy-this-year
      - e-generated-energy
      - e-datetime
      - e-battery-type
      - e-battery-rated-electric-charge
      - e-temperature-compensation-coefficient
      - e-battery-high-voltage-disconnect
      - e-battery-charging-limit-voltage
      - e-battery-high-voltage-reconnect
      - e-battery-equalization-voltage
      - e-battery-boost-voltage
      - e-battery-float-voltage
      - e-battery-boost-reconnect-voltage
      - e-battery-low-voltage-reconnect
      - e-battery-undervoltage-recovery
      - e-battery-undervoltage-warning
      - e-battery-low-voltage-disconnect
      - e-battery-discharging-limit
      - e-battery-equalization-cycle
      - e-battery-equalization-duration
      - e-battery-boost-duration
  - id: charge-controller
    mqtt_messages:
      - homeassistant/sensor/default/charge-controller-battery-voltage-status/config:
          device:
            name: EPEVER solar charge controller
            manufacturer: EPEVER
            model: XTRA 4415N
            identifiers: epever-xtra-4415n
          name: Battery Voltage Status
          entity_category: diagnostic
          state_topic: epever-xtra-4415n/battery-voltage-status
          object_id: epever-xtra-4415n-battery-voltage-status
          unique_id: epever-xtra-4415n-battery-voltage-status
      - homeassistant/sensor/default/charge-controller-battery-temperature-status/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Battery Temperature Status
          state_topic: epever-xtra-4415n/battery-temperature-status
          object_id: epever-xtra-4415n-battery-temperature-status
          unique_id: epever-xtra-4415n-battery-temperature-status
      - homeassistant/binary_sensor/default/charge-controller-battery-internal-resistance-abnormal/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Battery internal resistance abnormal
          state_topic: epever-xtra-4415n/battery-internal-resistance-abnormal
          object_id: epever-xtra-4415n-battery-internal-resistance-abnormal
          unique_id: epever-xtra-4415n-battery-internal-resistance-abnormal
      - homeassistant/binary_sensor/default/charge-controller-battery-voltage-identification-incorrect/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Battery voltage identification incorrect
          state_topic: epever-xtra-4415n/battery-voltage-identification-incorrect
          object_id: epever-xtra-4415n-battery-voltage-identification-incorrect
          unique_id: epever-xtra-4415n-battery-voltage-identification-incorrect
      - homeassistant/sensor/default/charge-controller-input-voltage-status/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Input Voltage Status
          state_topic: epever-xtra-4415n/input-voltage-status
          object_id: epever-xtra-4415n-input-voltage-status
          unique_id: epever-xtra-4415n-input-voltage-status
      - homeassistant/binary_sensor/default/charge-controller-charging-mosfet-shorted/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Charging MOSFET shorted
          state_topic: epever-xtra-4415n/charging-mosfet-shorted
          object_id: epever-xtra-4415n-charging-mosfet-shorted
          unique_id: epever-xtra-4415n-charging-mosfet-shorted
      - homeassistant/binary_sensor/default/charge-controller-charging-or-anti-reverse-mosfet-shorted/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Charging or anti-reverse MOSFET shorted
          state_topic: epever-xtra-4415n/charging-or-anti-reverse-mosfet-shorted
          object_id: epever-xtra-4415n-charging-or-anti-reverse-mosfet-shorted
          unique_id: epever-xtra-4415n-charging-or-anti-reverse-mosfet-shorted
      - homeassistant/binary_sensor/default/charge-controller-anti-reverse-mosfet-shorted/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Anti-reverse MOSFET shorted
          state_topic: epever-xtra-4415n/anti-reverse-mosfet-shorted
          object_id: epever-xtra-4415n-anti-reverse-mosfet-shorted
          unique_id: epever-xtra-4415n-anti-reverse-mosfet-shorted
      - homeassistant/binary_sensor/default/charge-controller-input-overcurrent/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Input over-current
          state_topic: epever-xtra-4415n/input-overcurrent
          object_id: epever-xtra-4415n-input-overcurrent
          unique_id: epever-xtra-4415n-input-overcurrent
      - homeassistant/binary_sensor/default/charge-controller-load-overcurrent/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Load over-current
          state_topic: epever-xtra-4415n/load-overcurrent
          object_id: epever-xtra-4415n-load-overcurrent
          unique_id: epever-xtra-4415n-load-overcurrent
      - homeassistant/binary_sensor/default/charge-controller-load-shorted/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Load shorted
          state_topic: epever-xtra-4415n/load-shorted
          object_id: epever-xtra-4415n-load-shorted
          unique_id: epever-xtra-4415n-load-shorted
      - homeassistant/binary_sensor/default/charge-controller-load-mosfet-shorted/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Load MOSFET shorted
          state_topic: epever-xtra-4415n/load-mosfet-shorted
          object_id: epever-xtra-4415n-load-mosfet-shorted
          unique_id: epever-xtra-4415n-load-mosfet-shorted
      - homeassistant/sensor/default/charge-controller-charging-type/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Charging Type
          state_topic: epever-xtra-4415n/charging-type
          object_id: epever-xtra-4415n-charging-type
          unique_id: epever-xtra-4415n-charging-type
      - homeassistant/binary_sensor/default/charge-controller-charging-equipment-fault/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Charging equipment fault
          state_topic: epever-xtra-4415n/charging-equipment-fault
          object_id: epever-xtra-4415n-charging-equipment-fault
          unique_id: epever-xtra-4415n-charging-equipment-fault
      - homeassistant/binary_sensor/default/charge-controller-charging-equipment-running/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Charging equipment running
          state_topic: epever-xtra-4415n/charging-equipment-running
          object_id: epever-xtra-4415n-charging-equipment-running
          unique_id: epever-xtra-4415n-charging-equipment-running
      - homeassistant/sensor/default/charge-controller-load-voltage-status/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Load voltage status
          state_topic: epever-xtra-4415n/load-voltage-status
          object_id: epever-xtra-4415n-load-voltage-status
          unique_id: epever-xtra-4415n-load-voltage-status
      - homeassistant/sensor/default/charge-controller-load-power-status/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Load power status
          state_topic: epever-xtra-4415n/load-power-status
          object_id: epever-xtra-4415n-load-power-status
          unique_id: epever-xtra-4415n-load-power-status
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-shorted/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment shorted
          state_topic: epever-xtra-4415n/discharging-equipment-shorted
          object_id: epever-xtra-4415n-discharging-equipment-shorted
          unique_id: epever-xtra-4415n-discharging-equipment-shorted
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-unable-to-discharge/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment unable to discharge
          state_topic: epever-xtra-4415n/discharging-equipment-unable-to-discharge
          object_id: epever-xtra-4415n-discharging-equipment-unable-to-discharge
          unique_id: epever-xtra-4415n-discharging-equipment-unable-to-discharge
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-unable-to-stop-discharging/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment unable to stop discharging
          state_topic: epever-xtra-4415n/discharging-equipment-unable-to-stop-discharging
          object_id: epever-xtra-4415n-discharging-equipment-unable-to-stop-discharging
          unique_id: epever-xtra-4415n-discharging-equipment-unable-to-stop-discharging
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-output-voltage-abnormal/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment output voltage abnormal
          state_topic: epever-xtra-4415n/discharging-equipment-output-voltage-abnormal
          object_id: epever-xtra-4415n-discharging-equipment-output-voltage-abnormal
          unique_id: epever-xtra-4415n-discharging-equipment-output-voltage-abnormal
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-input-overvoltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment input overvoltage
          state_topic: epever-xtra-4415n/discharging-equipment-input-overvoltage
          object_id: epever-xtra-4415n-discharging-equipment-input-overvoltage
          unique_id: epever-xtra-4415n-discharging-equipment-input-overvoltage
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-high-voltage-side-shorted/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment high voltage side shorted
          state_topic: epever-xtra-4415n/discharging-equipment-high-voltage-side-shorted
          object_id: epever-xtra-4415n-discharging-equipment-high-voltage-side-shorted
          unique_id: epever-xtra-4415n-discharging-equipment-high-voltage-side-shorted
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-boost-overvoltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment boost overvoltage
          state_topic: epever-xtra-4415n/discharging-equipment-boost-overvoltage
          object_id: epever-xtra-4415n-discharging-equipment-boost-overvoltage
          unique_id: epever-xtra-4415n-discharging-equipment-boost-overvoltage
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-output-overvoltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment output overvoltage
          state_topic: epever-xtra-4415n/discharging-equipment-output-overvoltage
          object_id: epever-xtra-4415n-discharging-equipment-output-overvoltage
          unique_id: epever-xtra-4415n-discharging-equipment-output-overvoltage
      - homeassistant/binary_sensor/default/charge-controller-discharging-equipment-fault/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment fault
          state_topic: epever-xtra-4415n/discharging-equipment-fault
          object_id: epever-xtra-4415n-discharging-equipment-fault
          unique_id: epever-xtra-4415n-discharging-equipment-fault
      - homeassistant/binary_sensor/derunning/charge-controller-discharging-equipment-running/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Discharging equipment running
          state_topic: epever-xtra-4415n/discharging-equipment-running
          object_id: epever-xtra-4415n-discharging-equipment-running
          unique_id: epever-xtra-4415n-discharging-equipment-running
      - homeassistant/sensor/default/charge-controller-battery-temperature/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: temperature
          name: Battery Temperature
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-temperature
          object_id: epever-xtra-4415n-battery-temperature
          unique_id: epever-xtra-4415n-battery-temperature
          unit_of_measurement: C
      - homeassistant/sensor/default/charge-controller-device-temperature/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: temperature
          name: Device Temperature
          state_class: measurement
          state_topic: epever-xtra-4415n/device-temperature
          object_id: epever-xtra-4415n-device-temperature
          unique_id: epever-xtra-4415n-device-temperature
          unit_of_measurement: C
      - homeassistant/sensor/default/charge-controller-power-components-temperature/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: temperature
          name: Power Components Temperature
          state_class: measurement
          state_topic: epever-xtra-4415n/power-components-temperature
          object_id: epever-xtra-4415n-power-components-temperature
          unique_id: epever-xtra-4415n-power-components-temperature
          unit_of_measurement: C
      - homeassistant/sensor/default/charge-controller-battery-estimated-soc/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: battery
          name: Battery estimated State of Charge
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-estimated-soc
          object_id: epever-xtra-4415n-battery-estimated-soc
          unique_id: epever-xtra-4415n-battery-estimated-soc
          unit_of_measurement: "%"
      - homeassistant/sensor/default/charge-controller-remote-battery-temperature/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: temperature
          name: Remote Sensor Battery Temperature
          state_class: measurement
          state_topic: epever-xtra-4415n/remote-battery-temperature
          object_id: epever-xtra-4415n-remote-battery-temperature
          unique_id: epever-xtra-4415n-remote-battery-temperature
          unit_of_measurement: C
      - homeassistant/sensor/default/charge-controller-combined-battery-temperature/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: temperature
          name: Combined Battery Temperature
          state_class: measurement
          state_topic: epever-xtra-4415n/combined-battery-temperature
          object_id: epever-xtra-4415n-combined-battery-temperature
          unique_id: epever-xtra-4415n-combined-battery-temperature
          unit_of_measurement: C
      - homeassistant/sensor/default/charge-controller-ambient-temperature/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: temperature
          name: Ambient Temperature
          state_class: measurement
          state_topic: epever-xtra-4415n/ambient-temperature
          object_id: epever-xtra-4415n-ambient-temperature
          unique_id: epever-xtra-4415n-ambient-temperature
          unit_of_measurement: C
      - homeassistant/sensor/default/charge-controller-battery-impedance/config:
          device:
            identifiers: epever-xtra-4415n
          name: Battery Connection Impedance
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-impedance
          object_id: epever-xtra-4415n-battery-impedance
          unique_id: epever-xtra-4415n-battery-impedance
          unit_of_measurement: m
      - homeassistant/binary_sensor/default/charge-controller-charging-device-on/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: diagnostic
          name: Charging Device Turned On
          state_topic: epever-xtra-4415n/charging-device-on
          object_id: epever-xtra-4415n-charging-device-on
          unique_id: epever-xtra-4415n-charging-device-on
      - homeassistant/sensor/default/charge-controller-battery-float-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Float Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-float-voltage
          object_id: epever-xtra-4415n-battery-float-voltage
          unique_id: epever-xtra-4415n-battery-float-voltage
          unit_of_measurement: V
    sleep: 60
    tasks:
      - e-battery-voltage-status
      - e-battery-temperature-status
      - e-battery-internal-resistance-abnormal
      - e-battery-voltage-identification-incorrect
      - e-input-voltage-status
      - e-charging-mosfet-shorted
      - e-charging-or-anti-reverse-mosfet-shorted
      - e-anti-reverse-mosfet-shorted
      - e-input-overcurrent
      - e-load-overcurrent
      - e-load-shorted
      - e-load-mosfet-shorted
      - e-charging-type
      - e-charging-equipment-fault
      - e-charging-equipment-running
      - e-load-voltage-status
      - e-load-power-status
      - e-discharging-equipment-shorted
      - e-discharging-equipment-unable-to-discharge
      - e-discharging-equipment-unable-to-stop-discharging
      - e-discharging-equipment-output-voltage-abnormal
      - e-discharging-equipment-input-overvoltage
      - e-discharging-equipment-high-voltage-side-shorted
      - e-discharging-equipment-boost-overvoltage
      - e-discharging-equipment-output-overvoltage
      - e-discharging-equipment-fault
      - e-discharging-equipment-running
      - e-battery-temperature
      - e-device-temperature
      - e-power-components-temperature
      - e-battery-estimated-soc
      - e-remote-battery-temperature
      - e-combined-battery-temperature
      - e-ambient-temperature
      - e-battery-impedance
      - e-charging-device-on
      - e-battery-float-voltage
  - id: charge-controller-important
    mqtt_messages:
      - homeassistant/sensor/default/charge-controller-solar-voltage/config:
          device:
            name: EPEVER solar charge controller
            manufacturer: EPEVER
            model: XTRA 4415N
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Solar Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/solar-voltage
          object_id: epever-xtra-4415n-solar-voltage
          unique_id: epever-xtra-4415n-solar-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-solar-current/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: current
          name: Solar Current
          state_class: measurement
          state_topic: epever-xtra-4415n/solar-current
          object_id: epever-xtra-4415n-solar-current
          unique_id: epever-xtra-4415n-solar-current
          unit_of_measurement: A
      - homeassistant/sensor/default/charge-controller-solar-power/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: power
          name: Solar Power
          state_class: measurement
          state_topic: epever-xtra-4415n/solar-power
          object_id: epever-xtra-4415n-solar-power
          unique_id: epever-xtra-4415n-solar-power
          unit_of_measurement: W
      - homeassistant/sensor/default/charge-controller-battery-charging-power/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: power
          name: Battery Charging Power
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-charging-power
          object_id: epever-xtra-4415n-battery-charging-power
          unique_id: epever-xtra-4415n-battery-charging-power
          unit_of_measurement: W
      - homeassistant/sensor/default/charge-controller-battery-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: voltage
          name: Battery Voltage
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-voltage
          object_id: epever-xtra-4415n-battery-voltage
          unique_id: epever-xtra-4415n-battery-voltage
          unit_of_measurement: V
      - homeassistant/sensor/default/charge-controller-battery-net-current/config:
          device:
            identifiers: epever-xtra-4415n
          device_class: current
          name: Battery Net Current
          state_class: measurement
          state_topic: epever-xtra-4415n/battery-net-current
          object_id: epever-xtra-4415n-battery-net-current
          unique_id: epever-xtra-4415n-battery-net-current
          unit_of_measurement: A
    sleep: 10
    tasks:
      - e-solar-voltage
      - e-solar-current
      - e-solar-power
      - e-battery-charging-power
      - e-battery-voltage
      - e-battery-net-current

handlers:
  - id: e-datetime-set
    device: epever-xtra-4415n-relaxed-timeout
    mqtt_topic: epever-xtra-4415n/datetime/set
    value:
      type: datetime
      data:
        - byte:
            register_type: holding
            address: 0x9015
            byte_index: 0
            increase_by: 2000
        - byte:
            register_type: holding
            address: 0x9015
            byte_index: 1
        - byte:
            register_type: holding
            address: 0x9014
            byte_index: 0
        - byte:
            register_type: holding
            address: 0x9014
            byte_index: 1
        - byte:
            register_type: holding
            address: 0x9013
            byte_index: 0
        - byte:
            register_type: holding
            address: 0x9013
            byte_index: 1
  - id: e-battery-equalization-voltage-set
    device: epever-xtra-4415n-relaxed-timeout
    mqtt_topic: epever-xtra-4415n/battery-equalization-voltage/set
    value:
      type: float
      data:
        - short:
            register_type: holding
            writable_block:
              start_address: 0x9003
              stop_address: 0x900F
            address: 0x9006
            scale_factor: 100
  - id: e-battery-boost-voltage-set
    device: epever-xtra-4415n-relaxed-timeout
    mqtt_topic: epever-xtra-4415n/battery-boost-voltage/set
    value:
      type: float
      data:
        - short:
            register_type: holding
            writable_block:
              start_address: 0x9003
              stop_address: 0x900F
            address: 0x9007
            scale_factor: 100
  - id: e-battery-float-voltage-set
    device: epever-xtra-4415n-relaxed-timeout
    mqtt_topic: epever-xtra-4415n/battery-float-voltage/set
    value:
      type: float
      data:
        - short:
            register_type: holding
            writable_block:
              start_address: 0x9003
              stop_address: 0x900F
            address: 0x9008
            scale_factor: 100

services:
  - id: charge-controller-voltages
    mqtt_messages:
      - homeassistant/text/default/charge-controller-datetime/config:
          device:
            name: EPEVER solar charge controller
            manufacturer: EPEVER
            model: XTRA 4415N
            identifiers: epever-xtra-4415n
          entity_category: config
          name: Date and Time
          command_topic: epever-xtra-4415n/datetime/set
          state_topic: epever-xtra-4415n/datetime
          object_id: epever-xtra-4415n-datetime-configurable
          unique_id: epever-xtra-4415n-datetime-configurable
      - homeassistant/number/default/charge-controller-battery-equalization-voltage/config:
          device:
            name: EPEVER solar charge controller
            manufacturer: EPEVER
            model: XTRA 4415N
            identifiers: epever-xtra-4415n
          entity_category: config
          name: Battery Equalization Voltage
          step: 0.01
          state_class: measurement
          command_topic: epever-xtra-4415n/battery-equalization-voltage/set
          state_topic: epever-xtra-4415n/battery-equalization-voltage
          object_id: epever-xtra-4415n-battery-equalization-voltage-configurable
          unique_id: epever-xtra-4415n-battery-equalization-voltage-configurable
          unit_of_measurement: V
      - homeassistant/number/default/charge-controller-battery-boost-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: config
          name: Battery Boost Voltage
          step: 0.01
          state_class: measurement
          command_topic: epever-xtra-4415n/battery-boost-voltage/set
          state_topic: epever-xtra-4415n/battery-boost-voltage
          object_id: epever-xtra-4415n-battery-boost-voltage-configurable
          unique_id: epever-xtra-4415n-battery-boost-voltage-configurable
          unit_of_measurement: V
      - homeassistant/number/default/charge-controller-battery-float-voltage/config:
          device:
            identifiers: epever-xtra-4415n
          entity_category: config
          name: Battery Float Voltage
          step: 0.01
          state_class: measurement
          command_topic: epever-xtra-4415n/battery-float-voltage/set
          state_topic: epever-xtra-4415n/battery-float-voltage
          object_id: epever-xtra-4415n-battery-float-voltage-configurable
          unique_id: epever-xtra-4415n-battery-float-voltage-configurable
          unit_of_measurement: V
    handlers:
      - e-datetime-set
      - e-battery-equalization-voltage-set
      - e-battery-boost-voltage-set
      - e-battery-float-voltage-set
